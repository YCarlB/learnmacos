首先下载vmware mac版，内核镜像，对应版本kdk（kernel debug kit）
https://developer.apple.com/download/more/?q=Kernel%20Debug%20Kit（kdk链接）
不知道自己内核什么版本
sw_vers | grep BuildVersion
用这个

然后在安装好的虚拟机内外q安装 kdk
sudo cp /Library/Developer/KDKs/KDK_10.12.6_16G29.kdk/System/Library/Kernels/kernel.development /System/Library/Kernels/


sudo nvram boot-args="debug=0x145 kext-dev-mode=1 kcsuffix=development pmuflags=1 -v"

boot-args：系统的启动参数
debug=0×141，表示系统可以进行远程链接调试
kext-dev-mode=1允许加载未签名kext
kcsuffix=development 允许我们启动系统，通过development，与之前我们copy到/Systems/Library/Kernel下的kernel.development对应，如果我们之前拷贝的是kernel.debug，那么这里填kcsuffic=debug
pmuflags=1关闭定时器
-v显示内核加载信息.


然后再清除kext缓存
sudo kextcache -invalidate /

c接着配置lldb
$lldb

>target create /Library/Developer/KDKs/KDK_10.12.6_16G29.kdk/System/Library/Kernels/kernel.development
然后会出现错误，依照错误提示执行两个命令
command script import "/Library/Developer/KDKs/KDK_10.11.1_15B42.kdk/System/Library/Kernels/kernel.development.dSYM/Contents/Resources/DWARF/../Python/kernel.py"

退出lldb
echo “settings set target.load-script-from-symbol-file true” > ~/.lldginit
再次进入重新输入



输入nvram -p查看参数是否设置成功

然后重启虚拟机（这里一定要重启，我关机再开了好几次没反应，气死了）
出现debug wait后在lldb中输入kdp-remote  192.168.31.128



